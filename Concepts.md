# Бизнес-требования

Progressor должен обеспечивать надёжное выполнение кода приложений (кода, реализующего бизнес-логику). Под надежностью 
подразумевается, что использование Progressor должно обеспечить приложению следующие свойства:
- возобновляемость - способность продолжить процесс после приостановки
- восстанавливаемость - способность продолжить выполнение процесса после сбоя
- реактивность - способность процесса реагировать на внешние события.

# Основные понятия (с учётом обратной совместимости с существующими процессорами)

Machine - управляющая машина, реализует control plane для управления процессами (обеспечивают отправку сигналов, вызов 
и восстановление процессов, сохраняют состояние процесса*). Машина идентифицируется по идентификатору уникальному в 
пределах namespace (см. ниже)
*под состоянием процесса здесь и далее подразумевается история событий, а также опциональные таймер и упрощенный статус.

Processor - это сервис, который реализует логику рабочего процесса, обрабатывает сигналы и вызовы, получаемые от машины, 
возвращает результат работы.

Namespace - механизм изоляции машин различных типов (то есть взаимодействующих с разными процессорами). В рамках 
namespace может быть переопределена retry policy
Примечание: в зависимости от реализации неймспейсы могут использоваться не только для изоляции разных типов машин, 
но и клиентов друг от друга.

Retry Policy - TODO

...

Каждому исполняемому экземпляру процесса соответствует своя управляющая машина 

# Описание функций и компонентов

Функции Progressor:
- создание(инициализация) экземпляров процессов (process execution) и соответствующих машин
- сохранение состояния, истории событий процесса и времени следующего запланированного вызова
- получение/удаление машин (с историей событий соответствующих процессов)
- вызов процесса по требованию (синхронный запрос, инициируемый клиентом)
- отправка сигнала процессу по расписанию (асинхронный запрос, инициируемый Progressor на основе предыдущего результата 
работы процесса)
- отправка сигнала процессу по требованию (асинхронный запрос, инициируемый клиентом)
- отправка сигнала процессу в соответствии с retry policy (возобновление процесса, обработка временных сбоев, 
частный случай отправки сигнала по расписанию)
- восстановление "сбойных" процессов
- ??? оповещение сторонних сервисов о создании/изменении/удалении процессов ???
- ??? управление неймспейсами (создание/редактирование/удаление) ???

Перечень компонентов:
- Automaton server (AS) - предоставляет API для доступа к управляющим машинам, обеспечивает вызов процессов по 
расписанию и в соответствии с retry policy, обеспечивает персистентность (?отправляет оповещения в сторонние сервисы?)
- Automaton client (AC) - взаимодействует с AS, иициирует старт (Start) и восстановление (Repair) процессов, осуществляет  
передачу событий в процесс (Call, Notify), возвращает состояние управляющей машины (Get), удаляет машину 
(вместе с историей соответствующего процесса, Remove)
- Processor server (PS) - предоставляет API для управления экземплярами процессов
- Processor client (PC) - взаимодействует с PS, осуществляет вызовы (ProcessCall, ProcessRepair) и отправку сигналов 
(ProcessSignal) в процессы

Примечание: роли и взаимодействие компонентов описаны ниже в сценариях. Необходимо отметить, что сервер Progressor реализует 
компоненты Automaton server и Processor client. Компоненты Processor server и Automaton client реализуются в 
пользовательском приложении и могут быть как совмещены в одном сервисе, так и реализованы раздельно.

# Сценарии
(в рамках сценариев показана связь компонентов и функций в динамике)

## Стандартный жизненный цикл

### Старт экземпляра процесса

### Срабатывание таймера

### Вызов процесса

### Нотификация процесса

### Получение состояния процесса

### Удаление управляющей машины (вместе с состоянием процесса)


## Сбои и восстановление процессов

### Обрабатываемый (временный) сбой в работе процесса

### Восстановление после обрабатываемого сбоя процессора (with retry policy)

### Необрабатываемый сбой в работе процесса

### Восстановление после необрабатываемого сбоя процессора (repairing)

### Внутренний сбой управляющей машины
(под этим сценарием подразумевается в первую очередь невозможность выполнить сохранение в базу или нотификацию в брокер, а не падение управляющей машины)

### Восстановление после внутреннего сбоя управляющей машины (???)




